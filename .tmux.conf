# ~/.tmux.conf
# tmux_cheatsheetを表示
bind ? display-popup -w 80% -h 80% -E "less ~/docs/tmux_cheatsheet.txt"

# prefixキーを Ctrl+a に変更（Ctrl+b より楽）
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# カラー対応
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# マウス操作有効
set -g mouse on

# ウィンドウ番号を1から開始
set -g base-index 1
setw -g pane-base-index 1

# --- 既存の設定 ---
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# --- 全体を突き抜ける「大分割」シリーズ ---
# 右に大きく
bind-key R split-window -hf -c "#{pane_current_path}"
# 左に大きく (before)
bind-key L split-window -hbf -c "#{pane_current_path}"
# 下に大きく
bind-key D split-window -v -f -c "#{pane_current_path}"
# 上に大きく (before)
bind-key U split-window -vb -f -c "#{pane_current_path}"

# ペイン移動をvimライクに
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ペインのリサイズ C-a + 矢印キー連続受付
bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5

# 設定リロード
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ステータスバー設定
set -g status-position bottom
set -g status-bg colour237
set -g status-fg colour137
set -g status-left ''
set -g status-right '#[fg=colour233,bg=colour241,bold] %Y/%m/%d #[fg=colour233,bg=colour245,bold] %H:%M '
set -g status-right-length 50
set -g status-left-length 20

# ウィンドウステータス
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# メッセージ
set -g message-style 'fg=colour232 bg=colour166 bold'

# 1. コピーモードのキー操作をviにする
setw -g mode-keys vi

# 2. 'v' で選択を始める (Vimのv)
bind -T copy-mode-vi v send -X begin-selection

# 3. 'V' (Shift+v) で行選択 (VimのShift+v)
bind -T copy-mode-vi V send -X select-line

# 4. 'y' でクリップボードにコピー (Vimのy)
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# ==================== OS判定 & 初期設定 ====================
if-shell 'test "$(uname)" = "Darwin"' 'set-option -g default-command "exec reattach-to-user-namespace -l $SHELL"'

# ==================== 通知設定 ====================
# ウィンドウの活動監視（裏で処理が終わったら色が変わる）
setw -g monitor-activity on
set -g visual-activity off  # 画面下メッセージはウザいのでオフ（ステータスバーの色変化のみ）

# アクティブなウィンドウがある時のステータスバーの色
setw -g window-status-activity-style bg=colour237,fg=colour166,bold

# ==================== Ghostty / Image Preview ====================
# 画像プレビューのパススルーを許可 (Ghostty + image.nvim用)
set -g allow-passthrough on
# 環境変数を更新
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
